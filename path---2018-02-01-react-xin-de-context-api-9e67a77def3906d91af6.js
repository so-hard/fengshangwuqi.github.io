webpackJsonp([0xd70cba3b87c1],{770:function(n,a){n.exports={data:{site:{siteMetadata:{siteUrl:"https://fengshangwuqi.github.io"}},markdownRemark:{html:'<div class="original-info">\n  <div className="original-address">\n    åŸæ–‡åœ°å€ï¼š\n    <a\n      href="https://blog.kentcdodds.com/reacts-%EF%B8%8F-new-context-api-70c9fe01596b"\n      target="_blank"\n      rel="noopener noreferrer"\n    >\n      React\'s âš›ï¸ new Context API\n    </a>\n  </div>\n  <div className="original-auth">ä½œè€…ï¼škentcdodds</div>\n</div>\n<p>è¿™ä¸å†æ˜¯ä¸€ä¸ª <strong>å®éªŒæ€§çš„ API</strong>ï¼Œå¹¶ä¸”å®ƒæ›´ç¬¦åˆå·¥ç¨‹åŒ–çš„ç†å¿µï¼Œç›®å‰å®ƒå·²æˆä¸º <strong>React ä¸€çº§æ£’çš„ API</strong>ã€‚</p>\n<blockquote>\n<p>âš ï¸ ï¼šå¤§å®¶å¯ä»¥é€šè¿‡ <a href="https://tinyletter.com/kentcdodds" target="_blank" rel="noopener noreferrer">newsletter</a> è·å–æˆ‘æœ€æ–°çš„èµ„è®¯ï¼Œæˆ‘ä¸€èˆ¬æ¯ä¸¤å‘¨é€šè¿‡é‚®ä»¶å‘é€ä¸€æ¬¡ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡è‡ªå·±çš„æ”¶ä»¶ç®±è·å–æ›´å¤šçš„å†…å®¹ã€‚</p>\n</blockquote>\n<p>React ä¸­çš„ <strong>context API</strong> ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“å§ï¼Œå¯èƒ½è·Ÿå¤§ä¼™ä¸€æ ·ï¼Œå½“çœ‹åˆ° React çš„å®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·æ—¶ï¼Œéƒ½ä¸æ•¢ç›´æ¥ä½¿ç”¨å®ƒã€‚</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/API-c35b793fa67380a56edba68e746ca472-b9936.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 660px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 80.6149732620321%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADhklEQVQ4y6WTS2wbRRjHTQUXpBZBRUVLoa2cxHaTXdvdNGl4VFC4ILgg8Jm4kKQPUXGGC5ee4IBD6QuBEJWKEOXRFirVieW4JqZtIqhjx/EjATuhu+vn2utH1h57/8yuk7jiceKT/vpmdmZ+8z1mDQZqgUuXH/X8+LntK/cl5vo1NzN9w8/4vD7G6/Eyfr+f8U5NMRMTE8zkpIdqUvcej4e57nYzV69cpWeu2b7/4co2w7pFArdOltJR/PZ7WAmG5omYEUlqZZkkU0ki8DwRRYGkUinqRSIIgi7tG8/fJdFoTEksLWF2dvaDDeA3337nisUWEfBPN/2BAKZmfsH07G34b9+E78bP8Pn8CAZDCM9HMK9rQR8vLEQRuDXT8t2cAY307AZw+x6z64mB5/HY4KHGrh6r2m2yqnu6+tSuNW/u5XRvNNnUbku/yg0cVLn9z6g9FptqstgJ3Y/tO41nNoC7u3pdZnYQ3X37ycjY2+q7772PsaMn8ObIMQwfHsMbzlEMO4/AedgJ57ADI6NHMXrkBN4aPY5jx98hL7z0KnY82dOJkEbi2ssMgrUPkTvBObVeV5DNZlEoFJDJZEDrB0HIgV8JQkh+jYosQlEaqFQqoEZOfnwem7fu7ACNPazLQoGMbYiEwxFV25XP5yFJEgoShWbzSIt/gE/+hGqZ15ahqi00m00d+NEn57HlkR33AE1rQPtTJBZL6MBSqYRqtapDRTFLgUmIqcvIZyP0spJ+IS8IOvDM2c+w+eH/AGoRtlotmqKgp7y6ukrBVBUJleId1Co8TXUV5XKZrks68PTfgXoN2QNg9z1N6JOgEaooFouo1WrtCNNZWssV5AU3ioUEsjkJUlGiPgd6OTl1+lM8tPXxDnCXsdfVZdkHM+3yQjSup7y8vKw3RksrTN/d0tIiZCmBSjmDYkluRyi1Ixw/dQ4PbtnWAXKDz7oOHnoZz734SiOeWNSAajqdVmmd9HFbTVWzznxD5IsvL2K3sbfzDoNzc+PtRsgtrXOKoqDRaEA7L8sy7vJppP/0oiBO4F5rUpzSoAWnNhcKnev8y5HIhxqAvrkarV2dQuq0y/+QLK97uZ7L5erRVK7+ayhVq1aqiMfj4+u8+8xm816O416z2+0OlmUdDMP8i9g1tedWq9UxwNkcQwc4R38/97rJZOrTWIZQKKRBN1HdT/XA/9CmCxcuGv4C5VwNs4fLyekAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="API"\n        title=""\n        src="/static/API-c35b793fa67380a56edba68e746ca472-73c38.png"\n        srcset="/static/API-c35b793fa67380a56edba68e746ca472-5902b.png 165w,\n/static/API-c35b793fa67380a56edba68e746ca472-f6c9c.png 330w,\n/static/API-c35b793fa67380a56edba68e746ca472-73c38.png 660w,\n/static/API-c35b793fa67380a56edba68e746ca472-b9936.png 748w"\n        sizes="(max-width: 660px) 100vw, 660px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>ç¬¬ä¸€æ¡æœç´¢ç»“æœæ˜¾ç¤ºçš„å°±æ˜¯ <a href="https://reactjs.org/docs/context.html#why-not-to-use-context" target="_blank" rel="noopener noreferrer">ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ context</a>ï¼Œè®©å¤§å®¶ç¬é—´äº§ç”Ÿå¿§è™‘ï¼Œè¯¥ç« èŠ‚æ˜¯è¿™ä¹ˆæè¿° context çš„ï¼š</p>\n<blockquote>\n<p>å¦‚æœä½ æƒ³è®©ä½ çš„åº”ç”¨æ›´åŠ ç¨³å®šï¼Œå°±åˆ«ä½¿ç”¨ <strong>context</strong>ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ APIï¼Œåœ¨æœªæ¥çš„ React ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>\n</blockquote>\n<p>âš ï¸ æ³¨æ„ï¼Œè¿™é‡Œçš„æ”¹å˜åŒ…å«ä¸­æ–­ï¼Œç»ˆæ­¢ï¼Œä¸å†ä½¿ç”¨ã€‚</p>\n<h2 id="é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨-context-å‘¢"><a href="#%E9%82%A3%E4%B9%88%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E4%BD%BF%E7%94%A8-context-%E5%91%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ context å‘¢</h2>\n<p>ä½ æ›¾ç»å†è¿‡å°è¯•åœ¨ä¸€ä¸ªå±‚çº§å¾ˆæ·±çš„ç»„ä»¶ä¸­è·å–æœ€å¤–å±‚ç»„ä»¶çš„ state çš„ç—›è‹¦ä¹ˆï¼Œè¿™ç§ç—›è‹¦å« <strong>prop drilling</strong>ï¼Œå¯è°“è®©äººæ¥è¿‘å´©æºƒçš„ã€‚å½“é‡åˆ°è¿™ç§æƒ…å½¢æ—¶ï¼Œä½ è‚¯å®šä¸ä¼šå–œæ¬¢ç”¨ props æ¥ä¼ é€’æ•°æ®ï¼Œå› ä¸ºå¦‚æœä¸­é—´æœ‰ä¸ªç»„ä»¶å‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªä»£ä»·å°†æ˜¯å‡ ä½• ğŸ˜‚ã€‚</p>\n<p>å®é™…ä¸Šï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å¸¸è§„çš„ <strong>JavaScript module</strong> æ¥è§„é¿ä»¥ä¸Šçš„é—®é¢˜ï¼Œå°†æ•°æ®å­˜åœ¨æŸä¸ª module ä¸­ï¼Œå°±å¯ä»¥å®ç°åœ¨ä»»ä½•åœ°æ–¹è®¿é—®å’Œå¯¼å…¥äº†ï¼Œä½†è¿™ä¹ˆåšä¼šè®©æ›´æ–°å˜å¾—å›°éš¾ï¼ˆä½ å¿…é¡»å®ç°ä¸€ä¸ª event åœ¨æ•°æ®æ›´æ–°æ—¶è§¦å‘ï¼Œé€šçŸ¥ç”¨æˆ·æ•°æ®å‘ç”Ÿæ”¹å˜ï¼‰ï¼Œå¹¶ä¸”ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“å¯¹ module ä¹Ÿä¼šæœ‰ <a href="https://stackoverflow.com/questions/40935571/why-singleton-store-in-flux-can-cause-issue-for-server-side-rendering/40974748#40974748" target="_blank" rel="noopener noreferrer">å½±å“</a>ã€‚</p>\n<p>å› æ­¤ï¼Œåƒ <a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer">redux</a> è¿™æ ·çš„è´Ÿè´£ <strong>çŠ¶æ€ç®¡ç†</strong> çš„ç¬¬ä¸‰æ–¹åº“è¿›å…¥äº†å¤§å®¶çš„è§†é‡ã€‚å®ƒå…è®¸ä½ åœ¨ä»»ä½•åœ°æ–¹ä» <strong>store</strong> è·å–æ•°æ®ï¼Œä½ éœ€è¦åšçš„åªæ˜¯ä½¿ç”¨ <strong>Provider</strong> åŒ…è£…ä¸€ä¸‹ï¼Œç„¶åå°±å¯ä»¥ç¥å¥‡åœ°åœ¨ <strong>connected</strong> çš„ç»„ä»¶ä¸­è½»æ¾åœ°è·å–æƒ³è¦çš„æ•°æ®äº†ã€‚</p>\n<p>ç„¶è€Œï¼Œå¦‚æœæˆ‘å‘Šè¯‰ä½  <strong>Provider</strong> å°±æ˜¯åœ¨ä½¿ç”¨ context è¿™ä¸ªå®éªŒæ€§ API å‘¢ï¼ŸğŸ˜± äº‹å®ç¡®å®æ˜¯è¿™æ ·çš„ï¼provider ç»„ä»¶å°†æ•°æ®å­˜è¿› context ä¸­ï¼Œconnect é«˜é˜¶ç»„ä»¶ä» context è·å–æ•°æ®ï¼Œæ‰€ä»¥ï¼Œredux äº‹å®å¹¶ä¸å…è®¸ä½ çš„æ•°æ®åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ã€‚</p>\n<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ context å‘¢ï¼Ÿå¯èƒ½æ˜¯å¤§å®¶å·²ç»æ·±æ·±åœ°çˆ±ä¸Šå®ƒäº†å§ï¼å³ä½¿ä½ æ²¡æœ‰ç›´æ¥ä½¿ç”¨ contextï¼Œä½ çš„åº”ç”¨ç¨‹åºä¹Ÿä¼šé€šè¿‡å¼•ç”¨åƒ <a href="https://github.com/reactjs/react-redux/blob/76dd7faa90981dd2f9efa76f3e2f26ecf2c12cf7/src/components/connectAdvanced.js#L136-L143" target="_blank" rel="noopener noreferrer">react-redux</a>ï¼Œ <a href="https://github.com/mobxjs/mobx-react/blob/dc249910c74c1b2e988a879be07f10aeaea90936/src/Provider.js#L19-L34" target="_blank" rel="noopener noreferrer">MobX-react</a>ï¼Œ <a href="https://github.com/ReactTraining/react-router/blob/e6f9017c947b3ae49affa24cc320d0a86f765b55/packages/react-router/modules/Router.js#L23-L34" target="_blank" rel="noopener noreferrer">react-router</a>ï¼Œ <a href="https://github.com/paypal/glamorous/blob/7468bfc76f46783cac841e20973ed119c771f3b7/src/theme-provider.js#L33-L37" target="_blank" rel="noopener noreferrer">glamorous</a> è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“é—´æ¥ç”¨åˆ°å®ƒã€‚</p>\n<h2 id="context-é‡ç”Ÿå•¦"><a href="#context-%E9%87%8D%E7%94%9F%E5%95%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Context é‡ç”Ÿå•¦</h2>\n<p>ç°åœ¨æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬æ˜¯å¦‚æ­¤åœ°çƒ­çˆ± contextï¼Œä½†å®˜æ–¹æ–‡æ¡£çš„è­¦å‘Šä¾ç„¶è¿˜åœ¨ï¼šåœ¨ React çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œå¯èƒ½ä¸å†ä½¿ç”¨å®ƒï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œ<strong>context</strong> è¦æ­£å¼è·Ÿå¤§å®¶æ‰“æ‹›å‘¼äº†ï¼Œè€Œä¸”å¤§å®¶å¯èƒ½ä¼šæ¯”ä¹‹å‰æ›´çˆ±å®ƒã€‚</p>\n<p>ä¸€ä¸ªæœˆå‰ï¼ŒReact å›¢é˜Ÿ ä» <a href="https://github.com/yarnpkg/rfcs" target="_blank" rel="noopener noreferrer">yarn</a>ï¼Œ<a href="https://github.com/rust-lang/rfcs" target="_blank" rel="noopener noreferrer">rust</a> å’Œ <a href="https://github.com/emberjs/rfcs" target="_blank" rel="noopener noreferrer">Ember</a> çš„ <strong>rfcs ä»“åº“</strong> å—åˆ°å¯å‘ï¼Œå»ºç«‹äº†ä¸€ä¸ªè‡ªå·±çš„ <a href="https://github.com/reactjs/rfcs" target="_blank" rel="noopener noreferrer">rfcs</a> ä»“åº“ã€‚ä»“åº“ç¬¬ä¸€ä¸ª PR æ¥è‡ª <a href="https://twitter.com/acdlite" target="_blank" rel="noopener noreferrer">Andrew Clark</a>ï¼ˆReact å›¢é˜Ÿæ ¸å¿ƒæˆå‘˜ï¼‰ï¼ŒPR æ ‡é¢˜ä¸º <a href="https://github.com/reactjs/rfcs/pull/2" target="_blank" rel="noopener noreferrer">New version of context</a>ï¼Œå…¶ä¸­ <strong>Andrew Clark</strong> æ¦‚è¿°äº†æœªæ¥æ–°ç‰ˆæœ¬çš„ context æ˜¯æ€æ ·çš„ï¼Œä¹‹åè¿˜å­˜åœ¨ä¸€äº›æœ‰è¶£çš„è®¨è®ºï¼Œå‡ å¤©åï¼ŒAndrew Clark å°±å‘ React ä»“åº“æäº†ä¸€ä¸ª <a href="https://github.com/facebook/react/pull/11818" target="_blank" rel="noopener noreferrer">New context API</a> çš„ PRã€‚</p>\n<p>é‚£ä¹ˆï¼Œåˆ°åº•æœ‰ä»€ä¹ˆæ”¹å˜å‘¢ï¼Ÿæ®è‚‰çœ¼ä¼°è®¡ï¼Œæ–°çš„ API ä¸ä¹‹å‰çš„ API å­˜åœ¨ç™¾ä¸‡çº§åˆ«çš„å·®å¼‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ <a href="https://codesandbox.io/s/n4r0qq898j?from-embed" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹</a>ï¼š</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">\'light\'</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">ThemeProvider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span>theme<span class="token punctuation">:</span> <span class="token string">\'light\'</span><span class="token punctuation">}</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> ThemeContext<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">ThemeConsumer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> ThemeContext<span class="token punctuation">.</span><span class="token function">consume</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token operator">&lt;</span>ThemeProvider<span class="token operator">></span>\n      <span class="token operator">&lt;</span>ThemeConsumer<span class="token operator">></span><span class="token punctuation">{</span>val <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>val<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ThemeConsumer<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeProvider<span class="token operator">></span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<blockquote>\n<p>ä½ å¯èƒ½æ³¨æ„åˆ°ç¤ºä¾‹ä¸­ä½¿ç”¨åˆ°ä¸€ä¸ª <strong>render prop</strong>ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•å…³äºéœ€è¦ä½¿ç”¨ render prop çš„ context APIï¼Œä½ å¯ä»¥ä½¿ç”¨ context API è½»æ¾å®ç°é«˜é˜¶ç»„ä»¶æˆ–å…¶ä»–åŠŸèƒ½ã€‚</p>\n</blockquote>\n<p>æ–°çš„ <strong>context API</strong> ä¸»è¦ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>\n<ul>\n<li><strong>React.createContext</strong>ï¼šç”¨äºä¼ é€’åˆå§‹å€¼ï¼ˆå¯é€‰æ‹© <a href="https://twitter.com/acdlite/status/957446433656864768" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ bitmask çš„ä¸€ä¸ªå¥‡å¦™çš„é€‰æ‹©æ€§é€€å‡ºå‡½æ•°</a>ï¼‰ï¼Œè¿”å›ä¸€ä¸ªåŒ…å« provider å’Œ consumer çš„å¯¹è±¡ï¼›</li>\n<li><strong>provide</strong>ï¼šæ”¾ç½®åœ¨ç»„ä»¶æ ‘ä¸­çš„è¾ƒé«˜å±‚ï¼Œå¹¶å¯ä»¥æ¥æ”¶ä»»ä½•å€¼ï¼›</li>\n<li><strong>consume</strong>ï¼šåœ¨ provider ä¹‹åä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªè¿”å› JSX çš„å‡½æ•°ï¼ˆè¿™æœ‰ç‚¹åƒ render prop ç»„ä»¶ï¼Œä½† consume ä¸æ˜¯ç»„ä»¶ï¼‰ï¼›</li>\n</ul>\n<p>æˆ‘å¯¹è¿™ä¸ª API å……æ»¡äº†æœŸå¾…ï¼ŒReact å›¢é˜Ÿä¹Ÿå°†ä¼šç§»é™¤ <strong>context æ˜¯å®éªŒæ€§ API</strong> çš„è­¦å‘Šï¼Œå› ä¸ºå®ƒç°åœ¨æ˜¯æ¡†æ¶ <a href="https://twitter.com/acdlite/status/957445801302618112" target="_blank" rel="noopener noreferrer">ä¸€çº§æ£’çš„ç‰¹æ€§</a>ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¤§å®¶å°†ä¸å†é‚£ä¹ˆæ‹…å¿ƒä½¿ç”¨ context æ¥è§£å†³åº”ç”¨ä¸­ prop-drilling çš„é—®é¢˜äº†ï¼Œå¯¹ Redux ä¸å†é‚£ä¹ˆä¾èµ–ï¼Œå¯¹ React ä¹Ÿå°†æ›´åŠ å–œæ¬¢ã€‚</p>\n<p><a href="https://twitter.com/kentcdodds/status/911276059051438082" target="_blank" rel="noopener noreferrer">æˆ‘æœ€è¿‘åœ¨ twitter çœ‹åˆ°çš„</a>ï¼Œå¤§æ¦‚æ„æ€æ˜¯ï¼š</p>\n<blockquote>\n<p>å¤§å®¶ä¸æ˜¯å¾ˆæ„¿æ„ä¿æŒä½¿ç”¨æå€¡çš„ render æ–¹æ³•ï¼ŒåŠ é‡äº† prop drilling é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œæœ€ç»ˆæƒ³é€šè¿‡ redux æ¥ç¼“è§£ã€‚</p>\n</blockquote>\n<p>æ‰€ä»¥ï¼Œæˆ‘è®¤ä¸ºå¦‚æœæˆ‘ä»¬ä¸è¿‡æ—©æˆ–æ­¦æ–­åœ°å»ç ´å render æ–¹æ³•ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¸ä¼šé‚£ä¹ˆç—›è‹¦ï¼Œå³ä¾¿æœ€ç»ˆæˆ‘ä»¬å®åœ¨æ²¡æœ‰åŠæ³•é¿å…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ ¸å¿ƒçš„ React API æ¥è§£å†³ã€‚</p>\n<h2 id="context-å®è·µ"><a href="#context-%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Context å®è·µ</h2>\n<p>æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªå…³äº context APIï¼ˆæˆ–æ™®é€šçš„ render prop patternï¼‰çš„é—®é¢˜å¾ˆå¤šæ¬¡ï¼Œå°±æ˜¯å¦‚ä½•ç»„åˆ providers å’Œ consumersï¼Œå½“åœ¨ä¸€ä¸ª render æ–¹æ³•ä¸­æŠŠä¸€å † render prop ç»„ä»¶æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œå°±ä¼šåƒè¿™æ · <a href="https://twitter.com/acdlite/status/955955121979969537" target="_blank" rel="noopener noreferrer">åµŒå¥—</a>ã€‚</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/practice-10fcc983644e66d2d824bd1430d25227-f02de.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 404px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 198.01980198019803%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAoCAYAAAD+MdrbAAAACXBIWXMAAAsSAAALEgHS3X78AAAElklEQVRIx51W2ZLiRhDky/3sR3+Rw/6BiVhmvevhktCF7gOpdYt0VgNj7QwzC9sRHYKmSWVV1rVQdYeKu+1GBH6Ef75+R5rkaJsetWrR1j06fu7bnmcd6rpF07RI4gyrlw2+f/sXbTtA8c4hTLG4AtY8KPISQRChKms0PGtUh6Qo4OQBgiJGdjyiqlqoqkGeHRETQEgovrji/0s+F4IsgE17ZlGENbJQoSyVZta0fGFbQ3E3LRnzTsc99CPGYcI0Tuc7xBCsV8COF2SVUYF4ayGLIg1wzxoI+g6w7YbLzyekQQjT2MOyHTiOS1YtXzig15vshkGfiS/bptGsK/pa0cf/A/IyTicN2fFP250Jy9xjvTEJ6sOwAtiOh912i/3eQhzHiKOYPg9QqRpXnB8BcQaUN6/XGxxcD6aXw/EiMt5hb/lYGR7SNP3B5H4Yb5g8AxRzNpsdrL0Nw7RgWxYi34fr+fAOAfyDj2N+RJQq5MWRL8g/Ynhe0zTBpe/Wqw1N3sKybKRhzJisL16+3KOLTtx9/yFD6Av6SVCPJovpJlmuL4yzJEVbKYrY6bun06QF+xRQbwkHnlkE2xkmbCpuk7VNQRIK4biuFkZEieL0Y5NfGV4VJ5Md2W23xkV5C2We6/AR18i+i+EctGFYrNdbhswOURhqc8+//1TlmclyewZeUk3TtLEjyyxOZi++Q5RbLGW5XoIVmcZMy/kap9MDJs++11VFhoZWP0sSqLJCwx0n2eeivGU3F8hkOkqeFxRmHEdMzGvFGnk7l98AzsFG/jFyD8ygLUyy7GeV6Ha1+YShhEZbNyysimmW6acE/qso96g8B5Ry5Xme9l11LLWp4zj8GsPrZ1WWMCRjmNeGwfKVFjq4m6a+XbF/5kNZlu1itVoR0MbLxmLWmFhvbbh+qnvSXSq/mk0WHauzFN+aVUeYiVAD+4p0zId9WBRnE6dhfN9THhVFnlK9pT4aDJkgjBByi/LnljH+gg/5TJgdMRtYTLAsL7TpUg8fjsPX4Ga4BCz/DsWRbuiStbxEOuZDuTwHTRjYW2bLgQVXqviKFd1hBtXt8LnKt7asnKZKG5UKLv502WLDtCTgnWFzrcqydV1kxZHqLV1xI+wY6MfyTV+WIec8ObxndGspdc7pkqUry3K20pKAM5PbXhJ8evdHyd+npycsn5+xXC7xZfkFz89fGTahBowpiM9+LU1KTK6lfEmlsF2HY1qlw0Cxf1SsJvJZdpZl9Fuut7Ap2ApaPYV1eteMRamTqp3IcsQi4ljxx++/4e+//sTy6zeyeGbbNFhITTyy3GRCkJ+wOKfVkc5WeuiRffWexJ2k1ekB4EXX9fA5ZviM/phTgcvAtRmwB59TK88lxgpOrg0Lg3bJxRXyXVwjTxFpmk46ZBdy8PLywpLERs5RLWJHk+lKBAnp/MPhoKcDyQw5s22b33lOMaS/OI6jz8QazbAm4J6xJIxEtXGcdIkaxhGPLgm1hYwRGePoyJiSeJKkT6mmPGUkFpfIpCCKyufp0ks+yqSFUBVfKMqfvwIf6bczuJxdv6dZ8a74vs2s/wBdnBerN1Q9oAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="practice"\n        title=""\n        src="/static/practice-10fcc983644e66d2d824bd1430d25227-f02de.png"\n        srcset="/static/practice-10fcc983644e66d2d824bd1430d25227-70084.png 165w,\n/static/practice-10fcc983644e66d2d824bd1430d25227-1b591.png 330w,\n/static/practice-10fcc983644e66d2d824bd1430d25227-f02de.png 404w"\n        sizes="(max-width: 404px) 100vw, 404px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åšç‚¹ä»€ä¹ˆæ¥é¿å…å‘¢ï¼Ÿå…¶å®ï¼Œä¸ªäººè§‰å¾—æ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ï¼Œå¦‚æœä½ è§‰å¾—è¿™æ ·å¹¶ä¸å¥½ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¸¸è§„çš„ <strong>utility</strong> å‡½æ•°/ç»„ä»¶æ¥è§£å†³ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p>\n<div class="gatsby-highlight">\n      <pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">\'light\'</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">ThemeProvider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token comment">/* code */</span><span class="token punctuation">}</span>\n<span class="token keyword">const</span> <span class="token function-variable function">ThemeConsumer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> ThemeContext<span class="token punctuation">.</span><span class="token function">consume</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>\n<span class="token keyword">const</span> LanguageContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">\'en\'</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">LanguageProvider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token comment">/* code */</span><span class="token punctuation">}</span>\n<span class="token keyword">const</span> <span class="token function-variable function">LanguageConsumer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> LanguageContext<span class="token punctuation">.</span><span class="token function">consume</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>\n\n<span class="token keyword">function</span> <span class="token function">AppProviders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>LanguageProvider<span class="token operator">></span>\n      <span class="token operator">&lt;</span>ThemeProvider<span class="token operator">></span>\n        <span class="token punctuation">{</span>children<span class="token punctuation">}</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeProvider<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>LanguageProvider<span class="token operator">></span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">ThemeAndLanguageConsumer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>LanguageConsumer<span class="token operator">></span>\n      <span class="token punctuation">{</span>language <span class="token operator">=></span> <span class="token punctuation">(</span>\n        <span class="token operator">&lt;</span>ThemeConsumer<span class="token operator">></span>\n          <span class="token punctuation">{</span>theme <span class="token operator">=></span> <span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">{</span>language<span class="token punctuation">,</span> theme<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeConsumer<span class="token operator">></span>\n      <span class="token punctuation">)</span><span class="token punctuation">}</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>LanguageConsumer<span class="token operator">></span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token operator">&lt;</span>AppProviders<span class="token operator">></span>\n      <span class="token operator">&lt;</span>ThemeAndLanguageConsumer<span class="token operator">></span>\n        <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">{</span>theme<span class="token punctuation">,</span> language<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span> and <span class="token punctuation">{</span>language<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">}</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeAndLanguageConsumer<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>AppProviders<span class="token operator">></span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>ç›®æ ‡æ˜¯ä½¿ç”¨å¸¸è§çš„æ¡ˆä¾‹ï¼Œç»“åˆç‰¹æ®ŠåŠŸèƒ½çš„å‡½æ•°/ç»„ä»¶ï¼Œä½¿æ¡ˆä¾‹æ›´åŠ å·¥ç¨‹åŒ–ã€‚</p>\n<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¤§å®¶è¿˜å¯ä»¥å‚è€ƒ <a href="https://medium.com/@jmeas" target="_blank" rel="noopener noreferrer">jmeas</a> çš„ <a href="https://codesandbox.io/s/92pj14134y?from-embed" target="_blank" rel="noopener noreferrer">react-composer</a>ã€‚</p>\n<p>åœ¨è¿™é‡Œéœ€è¦æåŠçš„æ˜¯ï¼Œåœ¨å®è·µä¸­ï¼Œå¹¶ä¸å»ºè®®å¤§å®¶åµŒå¥—æ¸²æŸ“ props componentsï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œéƒ½å¯ä»¥é€‰æ‹©åˆ›å»ºå¤šä¸ªç®€å•æ˜“ç”¨çš„ç»„ä»¶ï¼Œç„¶åç»„åˆä½¿ç”¨ã€‚</p>\n<h2 id="æ€»ç»“"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>æ€»ç»“</h2>\n<p>æ­£å¦‚ä¸Šé¢æ‰€è¯´çš„ï¼Œæˆ‘å¯¹è¿™ä¸ª API å……æ»¡äº†æœŸå¾…ã€‚ç›®å‰æš‚æœªå‘å¸ƒï¼Œä½†åº”è¯¥ä¼šåŒ…å«åœ¨ä¸‹ä¸€ä¸ª <strong>minor</strong> ç‰ˆæœ¬ä¸­ã€‚ä¸åŒæ‹…å¿ƒï¼Œä¹‹å‰çš„ API ä¼šç»§ç»­æ­£å¸¸å·¥ä½œï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª major ç‰ˆæœ¬å‘å¸ƒï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªäººéƒ½æœ‰æ—¶é—´è¿ç§»ï¼Œè€Œä¸”ä¸ç”¨è¿‡äºæ‹…å¿ƒï¼ŒReact å›¢é˜Ÿåœ¨ Facebook æœ‰è¶…è¿‡ <strong>50,000</strong> ä¸ª React components éœ€è¦ç»´æŠ¤ï¼Œæ‰€ä»¥ï¼Œå°†æ¥å¾ˆæœ‰å¯èƒ½ä¼šå‘å¸ƒä¸€ä¸ª <strong>codemod</strong> å»è‡ªåŠ¨æ›´æ–°å¤§å¤šæ•°äººçš„ä»£ç ï¼ˆå°±åƒä»¥å¾€ä¸€æ ·ï¼‰ã€‚</p>\n<p>æœ€åå†è¡¨è¾¾ä¸€ä¸‹æˆ‘å¯¹æ­¤çš„å…´å¥‹ã€‚</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/twitter-140356a80193236669cce8fbf8bff474-f3fd1.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 499px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 48.496993987975955%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABgElEQVQoz5VSCU7DQAzMSxGP4FMI8RYKJTRn27SEXklz7GZztMlgu1SiUouEpZE3XnvWGdtaTKfIswymrmGMQVVVyPMcXdeBbRgGwTU7x/t+QKZPedbD3T2eH5/geD4c18Pr+B0voxG01heEt0AZaA8D/K8e/GlNbA9pmqHtDtBVjcrUcnGrq79MOtzsEmy2Cbbkl/FK/Gf8RbGddMm/zlIwapKFYyxL0zQCjjE6aojNchwHU9JxNpshCAIEYSgICRyfz+dwPY/uQsqZU2yGKFrA831MqJbvGJoeORG6LjzSb7VeEwkRRBGmRP42HgupT4+4pO1isRQSl/IjyvH9ALb9IXV7GupZIotftW1bCrmAE+M4hlIKSZKgKApBkqbIqPAc403g8+F4vBietd5sEa/W2CUp+Mza7bP8X8Pofw3QyvISSlcoSo1SafFFqUj8inQxMnVD4HPTtjdWB6ib051l6kaWulQVTc8Iadt24hnqhzgvFE2zubqbbJzb9z2+Aewl+vZT8zHkAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"\n        alt="twiiter"\n        title=""\n        src="/static/twitter-140356a80193236669cce8fbf8bff474-f3fd1.png"\n        srcset="/static/twitter-140356a80193236669cce8fbf8bff474-6085a.png 165w,\n/static/twitter-140356a80193236669cce8fbf8bff474-948ed.png 330w,\n/static/twitter-140356a80193236669cce8fbf8bff474-f3fd1.png 499w"\n        sizes="(max-width: 499px) 100vw, 499px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>',fields:{slug:"/2018-02-01-react-xin-de-context-api/"},internal:{content:'---\ntitle: React âš›ï¸ æ–°çš„ Context API\noriginal: false\ntag: FrontEnd,React,context\ndate: 2018-02-01T17:57:26+08:00\n---\n\n<div class="original-info">\n  <div className="original-address">\n    åŸæ–‡åœ°å€ï¼š\n    <a\n      href="https://blog.kentcdodds.com/reacts-%EF%B8%8F-new-context-api-70c9fe01596b"\n      target="_blank"\n      rel="noopener noreferrer"\n    >\n      React\'s âš›ï¸ new Context API\n    </a>\n  </div>\n  <div className="original-auth">ä½œè€…ï¼škentcdodds</div>\n</div>\n\nè¿™ä¸å†æ˜¯ä¸€ä¸ª **å®éªŒæ€§çš„ API**ï¼Œå¹¶ä¸”å®ƒæ›´ç¬¦åˆå·¥ç¨‹åŒ–çš„ç†å¿µï¼Œç›®å‰å®ƒå·²æˆä¸º **React ä¸€çº§æ£’çš„ API**ã€‚\n\n> âš ï¸ ï¼šå¤§å®¶å¯ä»¥é€šè¿‡ [newsletter](https://tinyletter.com/kentcdodds) è·å–æˆ‘æœ€æ–°çš„èµ„è®¯ï¼Œæˆ‘ä¸€èˆ¬æ¯ä¸¤å‘¨é€šè¿‡é‚®ä»¶å‘é€ä¸€æ¬¡ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡è‡ªå·±çš„æ”¶ä»¶ç®±è·å–æ›´å¤šçš„å†…å®¹ã€‚\n\nReact ä¸­çš„ **context API** ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“å§ï¼Œå¯èƒ½è·Ÿå¤§ä¼™ä¸€æ ·ï¼Œå½“çœ‹åˆ° React çš„å®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·æ—¶ï¼Œéƒ½ä¸æ•¢ç›´æ¥ä½¿ç”¨å®ƒã€‚\n\n![API](./images/API.png)\n\nç¬¬ä¸€æ¡æœç´¢ç»“æœæ˜¾ç¤ºçš„å°±æ˜¯ [ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ context](https://reactjs.org/docs/context.html#why-not-to-use-context)ï¼Œè®©å¤§å®¶ç¬é—´äº§ç”Ÿå¿§è™‘ï¼Œè¯¥ç« èŠ‚æ˜¯è¿™ä¹ˆæè¿° context çš„ï¼š\n\n> å¦‚æœä½ æƒ³è®©ä½ çš„åº”ç”¨æ›´åŠ ç¨³å®šï¼Œå°±åˆ«ä½¿ç”¨ **context**ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§çš„ APIï¼Œåœ¨æœªæ¥çš„ React ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚\n\nâš ï¸ æ³¨æ„ï¼Œè¿™é‡Œçš„æ”¹å˜åŒ…å«ä¸­æ–­ï¼Œç»ˆæ­¢ï¼Œä¸å†ä½¿ç”¨ã€‚\n\n## é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ context å‘¢\n\nä½ æ›¾ç»å†è¿‡å°è¯•åœ¨ä¸€ä¸ªå±‚çº§å¾ˆæ·±çš„ç»„ä»¶ä¸­è·å–æœ€å¤–å±‚ç»„ä»¶çš„ state çš„ç—›è‹¦ä¹ˆï¼Œè¿™ç§ç—›è‹¦å« **prop drilling**ï¼Œå¯è°“è®©äººæ¥è¿‘å´©æºƒçš„ã€‚å½“é‡åˆ°è¿™ç§æƒ…å½¢æ—¶ï¼Œä½ è‚¯å®šä¸ä¼šå–œæ¬¢ç”¨ props æ¥ä¼ é€’æ•°æ®ï¼Œå› ä¸ºå¦‚æœä¸­é—´æœ‰ä¸ªç»„ä»¶å‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªä»£ä»·å°†æ˜¯å‡ ä½• ğŸ˜‚ã€‚\n\nå®é™…ä¸Šï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å¸¸è§„çš„ **JavaScript module** æ¥è§„é¿ä»¥ä¸Šçš„é—®é¢˜ï¼Œå°†æ•°æ®å­˜åœ¨æŸä¸ª module ä¸­ï¼Œå°±å¯ä»¥å®ç°åœ¨ä»»ä½•åœ°æ–¹è®¿é—®å’Œå¯¼å…¥äº†ï¼Œä½†è¿™ä¹ˆåšä¼šè®©æ›´æ–°å˜å¾—å›°éš¾ï¼ˆä½ å¿…é¡»å®ç°ä¸€ä¸ª event åœ¨æ•°æ®æ›´æ–°æ—¶è§¦å‘ï¼Œé€šçŸ¥ç”¨æˆ·æ•°æ®å‘ç”Ÿæ”¹å˜ï¼‰ï¼Œå¹¶ä¸”ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“å¯¹ module ä¹Ÿä¼šæœ‰ [å½±å“](https://stackoverflow.com/questions/40935571/why-singleton-store-in-flux-can-cause-issue-for-server-side-rendering/40974748#40974748)ã€‚\n\nå› æ­¤ï¼Œåƒ [redux](https://redux.js.org/) è¿™æ ·çš„è´Ÿè´£ **çŠ¶æ€ç®¡ç†** çš„ç¬¬ä¸‰æ–¹åº“è¿›å…¥äº†å¤§å®¶çš„è§†é‡ã€‚å®ƒå…è®¸ä½ åœ¨ä»»ä½•åœ°æ–¹ä» **store** è·å–æ•°æ®ï¼Œä½ éœ€è¦åšçš„åªæ˜¯ä½¿ç”¨ **Provider** åŒ…è£…ä¸€ä¸‹ï¼Œç„¶åå°±å¯ä»¥ç¥å¥‡åœ°åœ¨ **connected** çš„ç»„ä»¶ä¸­è½»æ¾åœ°è·å–æƒ³è¦çš„æ•°æ®äº†ã€‚\n\nç„¶è€Œï¼Œå¦‚æœæˆ‘å‘Šè¯‰ä½  **Provider** å°±æ˜¯åœ¨ä½¿ç”¨ context è¿™ä¸ªå®éªŒæ€§ API å‘¢ï¼ŸğŸ˜± äº‹å®ç¡®å®æ˜¯è¿™æ ·çš„ï¼provider ç»„ä»¶å°†æ•°æ®å­˜è¿› context ä¸­ï¼Œconnect é«˜é˜¶ç»„ä»¶ä» context è·å–æ•°æ®ï¼Œæ‰€ä»¥ï¼Œredux äº‹å®å¹¶ä¸å…è®¸ä½ çš„æ•°æ®åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ã€‚\n\né‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ context å‘¢ï¼Ÿå¯èƒ½æ˜¯å¤§å®¶å·²ç»æ·±æ·±åœ°çˆ±ä¸Šå®ƒäº†å§ï¼å³ä½¿ä½ æ²¡æœ‰ç›´æ¥ä½¿ç”¨ contextï¼Œä½ çš„åº”ç”¨ç¨‹åºä¹Ÿä¼šé€šè¿‡å¼•ç”¨åƒ [react-redux](https://github.com/reactjs/react-redux/blob/76dd7faa90981dd2f9efa76f3e2f26ecf2c12cf7/src/components/connectAdvanced.js#L136-L143)ï¼Œ [MobX-react](https://github.com/mobxjs/mobx-react/blob/dc249910c74c1b2e988a879be07f10aeaea90936/src/Provider.js#L19-L34)ï¼Œ [react-router](https://github.com/ReactTraining/react-router/blob/e6f9017c947b3ae49affa24cc320d0a86f765b55/packages/react-router/modules/Router.js#L23-L34)ï¼Œ [glamorous](https://github.com/paypal/glamorous/blob/7468bfc76f46783cac841e20973ed119c771f3b7/src/theme-provider.js#L33-L37) è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“é—´æ¥ç”¨åˆ°å®ƒã€‚\n\n## Context é‡ç”Ÿå•¦\n\nç°åœ¨æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬æ˜¯å¦‚æ­¤åœ°çƒ­çˆ± contextï¼Œä½†å®˜æ–¹æ–‡æ¡£çš„è­¦å‘Šä¾ç„¶è¿˜åœ¨ï¼šåœ¨ React çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œå¯èƒ½ä¸å†ä½¿ç”¨å®ƒï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œ**context** è¦æ­£å¼è·Ÿå¤§å®¶æ‰“æ‹›å‘¼äº†ï¼Œè€Œä¸”å¤§å®¶å¯èƒ½ä¼šæ¯”ä¹‹å‰æ›´çˆ±å®ƒã€‚\n\nä¸€ä¸ªæœˆå‰ï¼ŒReact å›¢é˜Ÿ ä» [yarn](https://github.com/yarnpkg/rfcs)ï¼Œ[rust](https://github.com/rust-lang/rfcs) å’Œ [Ember](https://github.com/emberjs/rfcs) çš„ **rfcs ä»“åº“** å—åˆ°å¯å‘ï¼Œå»ºç«‹äº†ä¸€ä¸ªè‡ªå·±çš„ [rfcs](https://github.com/reactjs/rfcs) ä»“åº“ã€‚ä»“åº“ç¬¬ä¸€ä¸ª PR æ¥è‡ª [Andrew Clark](https://twitter.com/acdlite)ï¼ˆReact å›¢é˜Ÿæ ¸å¿ƒæˆå‘˜ï¼‰ï¼ŒPR æ ‡é¢˜ä¸º [New version of context](https://github.com/reactjs/rfcs/pull/2)ï¼Œå…¶ä¸­ **Andrew Clark** æ¦‚è¿°äº†æœªæ¥æ–°ç‰ˆæœ¬çš„ context æ˜¯æ€æ ·çš„ï¼Œä¹‹åè¿˜å­˜åœ¨ä¸€äº›æœ‰è¶£çš„è®¨è®ºï¼Œå‡ å¤©åï¼ŒAndrew Clark å°±å‘ React ä»“åº“æäº†ä¸€ä¸ª [New context API](https://github.com/facebook/react/pull/11818) çš„ PRã€‚\n\né‚£ä¹ˆï¼Œåˆ°åº•æœ‰ä»€ä¹ˆæ”¹å˜å‘¢ï¼Ÿæ®è‚‰çœ¼ä¼°è®¡ï¼Œæ–°çš„ API ä¸ä¹‹å‰çš„ API å­˜åœ¨ç™¾ä¸‡çº§åˆ«çš„å·®å¼‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ [ç¤ºä¾‹](https://codesandbox.io/s/n4r0qq898j?from-embed)ï¼š\n\n```javascript\nconst ThemeContext = React.createContext(\'light\')\nclass ThemeProvider extends React.Component {\n  state = {theme: \'light\'}\n  render() {\n    return ThemeContext.provide(this.state.theme, this.props.children)\n  }\n}\n\nconst ThemeConsumer = ({children}) => ThemeContext.consume(children)\n\nclass App extends React.Component {\n  render() {\n    <ThemeProvider>\n      <ThemeConsumer>{val => <div>{val}</div>}</ThemeConsumer>\n    </ThemeProvider>\n  }\n}\n```\n\n> ä½ å¯èƒ½æ³¨æ„åˆ°ç¤ºä¾‹ä¸­ä½¿ç”¨åˆ°ä¸€ä¸ª **render prop**ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•å…³äºéœ€è¦ä½¿ç”¨ render prop çš„ context APIï¼Œä½ å¯ä»¥ä½¿ç”¨ context API è½»æ¾å®ç°é«˜é˜¶ç»„ä»¶æˆ–å…¶ä»–åŠŸèƒ½ã€‚\n\næ–°çš„ **context API** ä¸»è¦ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n\n- **React.createContext**ï¼šç”¨äºä¼ é€’åˆå§‹å€¼ï¼ˆå¯é€‰æ‹© [ä½¿ç”¨ bitmask çš„ä¸€ä¸ªå¥‡å¦™çš„é€‰æ‹©æ€§é€€å‡ºå‡½æ•°](https://twitter.com/acdlite/status/957446433656864768)ï¼‰ï¼Œè¿”å›ä¸€ä¸ªåŒ…å« provider å’Œ consumer çš„å¯¹è±¡ï¼›\n- **provide**ï¼šæ”¾ç½®åœ¨ç»„ä»¶æ ‘ä¸­çš„è¾ƒé«˜å±‚ï¼Œå¹¶å¯ä»¥æ¥æ”¶ä»»ä½•å€¼ï¼›\n- **consume**ï¼šåœ¨ provider ä¹‹åä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªè¿”å› JSX çš„å‡½æ•°ï¼ˆè¿™æœ‰ç‚¹åƒ render prop ç»„ä»¶ï¼Œä½† consume ä¸æ˜¯ç»„ä»¶ï¼‰ï¼›\n\næˆ‘å¯¹è¿™ä¸ª API å……æ»¡äº†æœŸå¾…ï¼ŒReact å›¢é˜Ÿä¹Ÿå°†ä¼šç§»é™¤ **context æ˜¯å®éªŒæ€§ API** çš„è­¦å‘Šï¼Œå› ä¸ºå®ƒç°åœ¨æ˜¯æ¡†æ¶ [ä¸€çº§æ£’çš„ç‰¹æ€§](https://twitter.com/acdlite/status/957445801302618112)ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¤§å®¶å°†ä¸å†é‚£ä¹ˆæ‹…å¿ƒä½¿ç”¨ context æ¥è§£å†³åº”ç”¨ä¸­ prop-drilling çš„é—®é¢˜äº†ï¼Œå¯¹ Redux ä¸å†é‚£ä¹ˆä¾èµ–ï¼Œå¯¹ React ä¹Ÿå°†æ›´åŠ å–œæ¬¢ã€‚\n\n[æˆ‘æœ€è¿‘åœ¨ twitter çœ‹åˆ°çš„](https://twitter.com/kentcdodds/status/911276059051438082)ï¼Œå¤§æ¦‚æ„æ€æ˜¯ï¼š\n\n> å¤§å®¶ä¸æ˜¯å¾ˆæ„¿æ„ä¿æŒä½¿ç”¨æå€¡çš„ render æ–¹æ³•ï¼ŒåŠ é‡äº† prop drilling é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œæœ€ç»ˆæƒ³é€šè¿‡ redux æ¥ç¼“è§£ã€‚\n\næ‰€ä»¥ï¼Œæˆ‘è®¤ä¸ºå¦‚æœæˆ‘ä»¬ä¸è¿‡æ—©æˆ–æ­¦æ–­åœ°å»ç ´å render æ–¹æ³•ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¸ä¼šé‚£ä¹ˆç—›è‹¦ï¼Œå³ä¾¿æœ€ç»ˆæˆ‘ä»¬å®åœ¨æ²¡æœ‰åŠæ³•é¿å…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ ¸å¿ƒçš„ React API æ¥è§£å†³ã€‚\n\n## Context å®è·µ\n\næˆ‘çœ‹åˆ°äº†ä¸€ä¸ªå…³äº context APIï¼ˆæˆ–æ™®é€šçš„ render prop patternï¼‰çš„é—®é¢˜å¾ˆå¤šæ¬¡ï¼Œå°±æ˜¯å¦‚ä½•ç»„åˆ providers å’Œ consumersï¼Œå½“åœ¨ä¸€ä¸ª render æ–¹æ³•ä¸­æŠŠä¸€å † render prop ç»„ä»¶æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œå°±ä¼šåƒè¿™æ · [åµŒå¥—](https://twitter.com/acdlite/status/955955121979969537)ã€‚\n\n![practice](./images/practice.png)\n\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åšç‚¹ä»€ä¹ˆæ¥é¿å…å‘¢ï¼Ÿå…¶å®ï¼Œä¸ªäººè§‰å¾—æ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ï¼Œå¦‚æœä½ è§‰å¾—è¿™æ ·å¹¶ä¸å¥½ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¸¸è§„çš„ **utility** å‡½æ•°/ç»„ä»¶æ¥è§£å†³ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š\n\n```javascript\nconst ThemeContext = React.createContext(\'light\')\nclass ThemeProvider extends React.Component {/* code */}\nconst ThemeConsumer = ({children}) => ThemeContext.consume(children)\nconst LanguageContext = React.createContext(\'en\')\nclass LanguageProvider extends React.Component {/* code */}\nconst LanguageConsumer = ({children}) => LanguageContext.consume(children)\n\nfunction AppProviders({children}) {\n  return (\n    <LanguageProvider>\n      <ThemeProvider>\n        {children}\n      </ThemeProvider>\n    </LanguageProvider>\n  )\n}\n\nfunction ThemeAndLanguageConsumer({children}) {\n  return (\n    <LanguageConsumer>\n      {language => (\n        <ThemeConsumer>\n          {theme => children({language, theme})}\n        </ThemeConsumer>\n      )}\n    </LanguageConsumer>\n  )\n}\n\nclass App extends React.Component {\n  render() {\n    <AppProviders>\n      <ThemeAndLanguageConsumer>\n        {({theme, language}) => <div>{theme} and {language}</div>}\n      </ThemeAndLanguageConsumer>\n    </AppProviders>\n  }\n}\n```\n\nç›®æ ‡æ˜¯ä½¿ç”¨å¸¸è§çš„æ¡ˆä¾‹ï¼Œç»“åˆç‰¹æ®ŠåŠŸèƒ½çš„å‡½æ•°/ç»„ä»¶ï¼Œä½¿æ¡ˆä¾‹æ›´åŠ å·¥ç¨‹åŒ–ã€‚\n\né™¤æ­¤ä¹‹å¤–ï¼Œå¤§å®¶è¿˜å¯ä»¥å‚è€ƒ [jmeas](https://medium.com/@jmeas) çš„ [react-composer](https://codesandbox.io/s/92pj14134y?from-embed)ã€‚\n\nåœ¨è¿™é‡Œéœ€è¦æåŠçš„æ˜¯ï¼Œåœ¨å®è·µä¸­ï¼Œå¹¶ä¸å»ºè®®å¤§å®¶åµŒå¥—æ¸²æŸ“ props componentsï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œéƒ½å¯ä»¥é€‰æ‹©åˆ›å»ºå¤šä¸ªç®€å•æ˜“ç”¨çš„ç»„ä»¶ï¼Œç„¶åç»„åˆä½¿ç”¨ã€‚\n\n## æ€»ç»“\n\næ­£å¦‚ä¸Šé¢æ‰€è¯´çš„ï¼Œæˆ‘å¯¹è¿™ä¸ª API å……æ»¡äº†æœŸå¾…ã€‚ç›®å‰æš‚æœªå‘å¸ƒï¼Œä½†åº”è¯¥ä¼šåŒ…å«åœ¨ä¸‹ä¸€ä¸ª **minor** ç‰ˆæœ¬ä¸­ã€‚ä¸åŒæ‹…å¿ƒï¼Œä¹‹å‰çš„ API ä¼šç»§ç»­æ­£å¸¸å·¥ä½œï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª major ç‰ˆæœ¬å‘å¸ƒï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªäººéƒ½æœ‰æ—¶é—´è¿ç§»ï¼Œè€Œä¸”ä¸ç”¨è¿‡äºæ‹…å¿ƒï¼ŒReact å›¢é˜Ÿåœ¨ Facebook æœ‰è¶…è¿‡ **50,000** ä¸ª React components éœ€è¦ç»´æŠ¤ï¼Œæ‰€ä»¥ï¼Œå°†æ¥å¾ˆæœ‰å¯èƒ½ä¼šå‘å¸ƒä¸€ä¸ª **codemod** å»è‡ªåŠ¨æ›´æ–°å¤§å¤šæ•°äººçš„ä»£ç ï¼ˆå°±åƒä»¥å¾€ä¸€æ ·ï¼‰ã€‚\n\næœ€åå†è¡¨è¾¾ä¸€ä¸‹æˆ‘å¯¹æ­¤çš„å…´å¥‹ã€‚\n\n![twiiter](./images/twitter.png)\n'
},frontmatter:{title:"React âš›ï¸ æ–°çš„ Context API",tag:"FrontEnd,React,context",date:"2018-02-01",original:!1}}},pathContext:{slug:"/2018-02-01-react-xin-de-context-api/"}}}});