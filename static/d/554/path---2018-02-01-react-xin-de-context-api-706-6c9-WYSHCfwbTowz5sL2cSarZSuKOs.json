{"data":{"markdownRemark":{"html":"<div class=\"original-info\">\n  <div className=\"original-address\">\n    åŸæ–‡åœ°å€ï¼š\n    <a\n      href=\"https://blog.kentcdodds.com/reacts-%EF%B8%8F-new-context-api-70c9fe01596b\"\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n    >\n      React's âš›ï¸ new Context API\n    </a>\n  </div>\n  <div className=\"original-auth\">ä½œè€…ï¼škentcdodds</div>\n</div>\n<p>è¿™ä¸å†æ˜¯ä¸€ä¸ª <strong>å®éªŒæ€§çš„ API</strong>ï¼Œå¹¶ä¸”å®ƒæ›´ç¬¦åˆå·¥ç¨‹åŒ–çš„ç†å¿µï¼Œç›®å‰å®ƒå·²æˆä¸º <strong>React ä¸€çº§æ£’çš„ API</strong>ã€‚</p>\n<blockquote>\n<p>âš ï¸ ï¼šå¤§å®¶å¯ä»¥é€šè¿‡ <a href=\"https://tinyletter.com/kentcdodds\" target=\"_blank\" rel=\"noopener noreferrer\">newsletter</a> è·å–æˆ‘æœ€æ–°çš„èµ„è®¯ï¼Œæˆ‘ä¸€èˆ¬æ¯ä¸¤å‘¨é€šè¿‡é‚®ä»¶å‘é€ä¸€æ¬¡ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡è‡ªå·±çš„æ”¶ä»¶ç®±è·å–æ›´å¤šçš„å†…å®¹ã€‚</p>\n</blockquote>\n<p><strong>React</strong> ä¸­çš„ <strong>context API</strong> ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“å§ï¼Œå¯èƒ½è·Ÿå¤§ä¼™ä¸€æ ·ï¼Œå½“çœ‹åˆ° <strong>React</strong> çš„å®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·æ—¶ï¼Œéƒ½ä¸æ•¢ç›´æ¥ä½¿ç”¨å®ƒã€‚</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/API-c35b793fa67380a56edba68e746ca472-dd45d.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin: 30px 0;; max-width: 660px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 80.6149732620321%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAADhklEQVQ4y6WTS2wbRRjHTQUXpBZBRUVLoa2cxHaTXdvdNGl4VFC4ILgg8Jm4kKQPUXGGC5ee4IBD6QuBEJWKEOXRFirVieW4JqZtIqhjx/EjATuhu+vn2utH1h57/8yuk7jiceKT/vpmdmZ+8z1mDQZqgUuXH/X8+LntK/cl5vo1NzN9w8/4vD7G6/Eyfr+f8U5NMRMTE8zkpIdqUvcej4e57nYzV69cpWeu2b7/4co2w7pFArdOltJR/PZ7WAmG5omYEUlqZZkkU0ki8DwRRYGkUinqRSIIgi7tG8/fJdFoTEksLWF2dvaDDeA3337nisUWEfBPN/2BAKZmfsH07G34b9+E78bP8Pn8CAZDCM9HMK9rQR8vLEQRuDXT8t2cAY307AZw+x6z64mB5/HY4KHGrh6r2m2yqnu6+tSuNW/u5XRvNNnUbku/yg0cVLn9z6g9FptqstgJ3Y/tO41nNoC7u3pdZnYQ3X37ycjY2+q7772PsaMn8ObIMQwfHsMbzlEMO4/AedgJ57ADI6NHMXrkBN4aPY5jx98hL7z0KnY82dOJkEbi2ssMgrUPkTvBObVeV5DNZlEoFJDJZEDrB0HIgV8JQkh+jYosQlEaqFQqoEZOfnwem7fu7ACNPazLQoGMbYiEwxFV25XP5yFJEgoShWbzSIt/gE/+hGqZ15ahqi00m00d+NEn57HlkR33AE1rQPtTJBZL6MBSqYRqtapDRTFLgUmIqcvIZyP0spJ+IS8IOvDM2c+w+eH/AGoRtlotmqKgp7y6ukrBVBUJleId1Co8TXUV5XKZrks68PTfgXoN2QNg9z1N6JOgEaooFouo1WrtCNNZWssV5AU3ioUEsjkJUlGiPgd6OTl1+lM8tPXxDnCXsdfVZdkHM+3yQjSup7y8vKw3RksrTN/d0tIiZCmBSjmDYkluRyi1Ixw/dQ4PbtnWAXKDz7oOHnoZz734SiOeWNSAajqdVmmd9HFbTVWzznxD5IsvL2K3sbfzDoNzc+PtRsgtrXOKoqDRaEA7L8sy7vJppP/0oiBO4F5rUpzSoAWnNhcKnev8y5HIhxqAvrkarV2dQuq0y/+QLK97uZ7L5erRVK7+ayhVq1aqiMfj4+u8+8xm816O416z2+0OlmUdDMP8i9g1tedWq9UxwNkcQwc4R38/97rJZOrTWIZQKKRBN1HdT/XA/9CmCxcuGv4C5VwNs4fLyekAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"API\"\n        title=\"\"\n        src=\"/static/API-c35b793fa67380a56edba68e746ca472-65bfc.png\"\n        srcset=\"/static/API-c35b793fa67380a56edba68e746ca472-91730.png 165w,\n/static/API-c35b793fa67380a56edba68e746ca472-5a599.png 330w,\n/static/API-c35b793fa67380a56edba68e746ca472-65bfc.png 660w,\n/static/API-c35b793fa67380a56edba68e746ca472-dd45d.png 748w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>ç¬¬ä¸€æ¡æœç´¢ç»“æœæ˜¾ç¤ºçš„å°±æ˜¯ <a href=\"https://reactjs.org/docs/context.html#why-not-to-use-context\" target=\"_blank\" rel=\"noopener noreferrer\">ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ context</a>ï¼Œè®©å¤§å®¶ç¬é—´äº§ç”Ÿå¿§è™‘ï¼Œè¯¥ç« èŠ‚æ˜¯è¿™ä¹ˆæè¿° <strong>context</strong> çš„ï¼š</p>\n<blockquote>\n<p>å¦‚æœä½ æƒ³è®©ä½ çš„åº”ç”¨æ›´åŠ ç¨³å®šï¼Œå°±åˆ«ä½¿ç”¨ <strong>context</strong>ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª <strong>å®éªŒæ€§çš„ API</strong>ï¼Œåœ¨æœªæ¥çš„ <strong>React</strong> ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>\n</blockquote>\n<p>âš ï¸ æ³¨æ„ï¼Œè¿™é‡Œçš„æ”¹å˜åŒ…å«ä¸­æ–­ï¼Œç»ˆæ­¢ï¼Œä¸å†ä½¿ç”¨ã€‚</p>\n<h2 id=\"é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨-context-å‘¢\"><a href=\"#%E9%82%A3%E4%B9%88%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E8%A6%81%E4%BD%BF%E7%94%A8-context-%E5%91%A2\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ context å‘¢</h2>\n<p>ä½ æ›¾ç»å†è¿‡å°è¯•åœ¨ä¸€ä¸ªå±‚çº§å¾ˆæ·±çš„ç»„ä»¶ä¸­è·å–æœ€å¤–å±‚ç»„ä»¶çš„ <strong>state</strong> çš„ç—›è‹¦ä¹ˆï¼Œè¿™ç§ç—›è‹¦å« <strong>prop drilling</strong>ï¼Œå¯è°“è®©äººæ¥è¿‘å´©æºƒçš„ã€‚å½“é‡åˆ°è¿™ç§æƒ…å½¢æ—¶ï¼Œä½ è‚¯å®šä¸ä¼šå–œæ¬¢ç”¨ <strong>props</strong> æ¥ä¼ é€’æ•°æ®ï¼Œå› ä¸ºå¦‚æœä¸­é—´æœ‰ä¸ªç»„ä»¶å‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªä»£ä»·å°†æ˜¯å‡ ä½• ğŸ˜‚ã€‚</p>\n<p>å®é™…ä¸Šï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å¸¸è§„çš„ <strong>JavaScript module</strong> æ¥è§„é¿ä»¥ä¸Šçš„é—®é¢˜ï¼Œå°†æ•°æ®å­˜åœ¨æŸä¸ª <strong>module</strong> ä¸­ï¼Œå°±å¯ä»¥å®ç°åœ¨ä»»ä½•åœ°æ–¹è®¿é—®å’Œå¯¼å…¥äº†ï¼Œä½†è¿™ä¹ˆåšä¼šè®©æ›´æ–°å˜å¾—å›°éš¾ï¼ˆä½ å¿…é¡»å®ç°ä¸€ä¸ª <strong>event</strong> åœ¨æ•°æ®æ›´æ–°æ—¶è§¦å‘ï¼Œé€šçŸ¥ç”¨æˆ·æ•°æ®å‘ç”Ÿæ”¹å˜ï¼‰ï¼Œå¹¶ä¸”ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“å¯¹ <strong>module</strong> ä¹Ÿä¼šæœ‰ <a href=\"https://stackoverflow.com/questions/40935571/why-singleton-store-in-flux-can-cause-issue-for-server-side-rendering/40974748#40974748\" target=\"_blank\" rel=\"noopener noreferrer\">å½±å“</a>ã€‚</p>\n<p>å› æ­¤ï¼Œåƒ <a href=\"https://redux.js.org/\" target=\"_blank\" rel=\"noopener noreferrer\">redux</a> è¿™æ ·çš„è´Ÿè´£ <strong>çŠ¶æ€ç®¡ç†</strong> çš„ç¬¬ä¸‰æ–¹åº“è¿›å…¥äº†å¤§å®¶çš„è§†é‡ã€‚å®ƒå…è®¸ä½ åœ¨ä»»ä½•åœ°æ–¹ä» <strong>store</strong> è·å–æ•°æ®ï¼Œä½ éœ€è¦åšçš„åªæ˜¯ä½¿ç”¨ <strong>Provider</strong> åŒ…è£…ä¸€ä¸‹ï¼Œç„¶åå°±å¯ä»¥ç¥å¥‡åœ°åœ¨ <strong>connected</strong> çš„ç»„ä»¶ä¸­è½»æ¾åœ°è·å–æƒ³è¦çš„æ•°æ®äº†ã€‚</p>\n<p>ç„¶è€Œï¼Œå¦‚æœæˆ‘å‘Šè¯‰ä½  <strong>Provider</strong> å°±æ˜¯åœ¨ä½¿ç”¨ <strong>context</strong> è¿™ä¸ª <strong>å®éªŒæ€§ API</strong> å‘¢ï¼ŸğŸ˜± äº‹å®ç¡®å®æ˜¯è¿™æ ·çš„ï¼<strong>provider</strong> ç»„ä»¶å°†æ•°æ®å­˜è¿› <strong>context</strong> ä¸­ï¼Œ<strong>connect</strong> é«˜é˜¶ç»„ä»¶ä» <strong>context</strong> è·å–æ•°æ®ï¼Œæ‰€ä»¥ï¼Œ<strong>redux</strong> äº‹å®å¹¶ä¸å…è®¸ä½ çš„æ•°æ®åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ã€‚</p>\n<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ <strong>context</strong> å‘¢ï¼Ÿå¯èƒ½æ˜¯å¤§å®¶å·²ç»æ·±æ·±åœ°çˆ±ä¸Šå®ƒäº†å§ï¼å³ä½¿ä½ æ²¡æœ‰ç›´æ¥ä½¿ç”¨ <strong>context</strong>ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¹Ÿä¼šé€šè¿‡å¼•ç”¨åƒ <a href=\"https://github.com/reactjs/react-redux/blob/76dd7faa90981dd2f9efa76f3e2f26ecf2c12cf7/src/components/connectAdvanced.js#L136-L143\" target=\"_blank\" rel=\"noopener noreferrer\">react-redux</a>ï¼Œ <a href=\"https://github.com/mobxjs/mobx-react/blob/dc249910c74c1b2e988a879be07f10aeaea90936/src/Provider.js#L19-L34\" target=\"_blank\" rel=\"noopener noreferrer\">MobX-react</a>ï¼Œ <a href=\"https://github.com/ReactTraining/react-router/blob/e6f9017c947b3ae49affa24cc320d0a86f765b55/packages/react-router/modules/Router.js#L23-L34\" target=\"_blank\" rel=\"noopener noreferrer\">react-router</a>ï¼Œ <a href=\"https://github.com/paypal/glamorous/blob/7468bfc76f46783cac841e20973ed119c771f3b7/src/theme-provider.js#L33-L37\" target=\"_blank\" rel=\"noopener noreferrer\">glamorous</a> è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“é—´æ¥ç”¨åˆ°å®ƒã€‚</p>\n<h2 id=\"context-é‡ç”Ÿå•¦\"><a href=\"#context-%E9%87%8D%E7%94%9F%E5%95%A6\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Context é‡ç”Ÿå•¦</h2>\n<p>ç°åœ¨æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬æ˜¯å¦‚æ­¤åœ°çƒ­çˆ± <strong>context</strong>ï¼Œä½†å®˜æ–¹æ–‡æ¡£çš„è­¦å‘Šä¾ç„¶è¿˜åœ¨ï¼šåœ¨ <strong>React</strong> çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œå¯èƒ½ä¸å†ä½¿ç”¨å®ƒï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œ<strong>context</strong> è¦æ­£å¼è·Ÿå¤§å®¶æ‰“æ‹›å‘¼äº†ï¼Œè€Œä¸”å¤§å®¶å¯èƒ½ä¼šæ¯”ä¹‹å‰æ›´çˆ±å®ƒã€‚</p>\n<p>ä¸€ä¸ªæœˆå‰ï¼Œ<strong>React</strong> å›¢é˜Ÿ ä» <a href=\"https://github.com/yarnpkg/rfcs\" target=\"_blank\" rel=\"noopener noreferrer\">yarn</a>ï¼Œ<a href=\"https://github.com/rust-lang/rfcs\" target=\"_blank\" rel=\"noopener noreferrer\">rust</a> å’Œ <a href=\"https://github.com/emberjs/rfcs\" target=\"_blank\" rel=\"noopener noreferrer\">Ember</a> çš„ <strong>rfcs ä»“åº“</strong> å—åˆ°å¯å‘ï¼Œå»ºç«‹äº†ä¸€ä¸ªè‡ªå·±çš„ <a href=\"https://github.com/reactjs/rfcs\" target=\"_blank\" rel=\"noopener noreferrer\">rfcs</a> ä»“åº“ã€‚ä»“åº“ç¬¬ä¸€ä¸ª <strong>PR</strong> æ¥è‡ª <a href=\"https://twitter.com/acdlite\" target=\"_blank\" rel=\"noopener noreferrer\">Andrew Clark</a>ï¼ˆReact å›¢é˜Ÿæ ¸å¿ƒæˆå‘˜ï¼‰ï¼Œ<strong>PR</strong> æ ‡é¢˜ä¸º <a href=\"https://github.com/reactjs/rfcs/pull/2\" target=\"_blank\" rel=\"noopener noreferrer\">New version of context</a>ï¼Œå…¶ä¸­ <strong>Andrew Clark</strong> æ¦‚è¿°äº†æœªæ¥æ–°ç‰ˆæœ¬çš„ <strong>context</strong> æ˜¯æ€æ ·çš„ï¼Œä¹‹åè¿˜å­˜åœ¨ä¸€äº›æœ‰è¶£çš„è®¨è®ºï¼Œå‡ å¤©åï¼Œ<strong>Andrew Clark</strong> å°±å‘ <strong>React</strong> ä»“åº“æäº†ä¸€ä¸ª <a href=\"https://github.com/facebook/react/pull/11818\" target=\"_blank\" rel=\"noopener noreferrer\">New context API</a> çš„ <strong>PR</strong>ã€‚</p>\n<p>é‚£ä¹ˆï¼Œåˆ°åº•æœ‰ä»€ä¹ˆæ”¹å˜å‘¢ï¼Ÿæ®è‚‰çœ¼ä¼°è®¡ï¼Œæ–°çš„ <strong>API</strong> ä¸ä¹‹å‰çš„ <strong>API</strong> å­˜åœ¨ç™¾ä¸‡çº§åˆ«çš„å·®å¼‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ <a href=\"https://codesandbox.io/s/n4r0qq898j?from-embed\" target=\"_blank\" rel=\"noopener noreferrer\">ç¤ºä¾‹</a>ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ThemeContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'light'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ThemeProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\tstate <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> theme<span class=\"token punctuation\">:</span> <span class=\"token string\">'light'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> ThemeContext<span class=\"token punctuation\">.</span><span class=\"token function\">provide</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ThemeConsumer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ThemeContext<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token operator\">&lt;</span>ThemeProvider<span class=\"token operator\">></span>\n\t\t\t<span class=\"token operator\">&lt;</span>ThemeConsumer<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>val <span class=\"token operator\">=></span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>val<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeConsumer<span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeProvider<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<blockquote>\n<p>ä½ å¯èƒ½æ³¨æ„åˆ°ç¤ºä¾‹ä¸­ä½¿ç”¨åˆ°ä¸€ä¸ª <strong>render prop</strong>ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•å…³äºéœ€è¦ä½¿ç”¨ <strong>render prop</strong> çš„ <strong>context API</strong>ï¼Œä½ å¯ä»¥ä½¿ç”¨ <strong>context API</strong> è½»æ¾å®ç°é«˜é˜¶ç»„ä»¶æˆ–å…¶ä»–åŠŸèƒ½ã€‚</p>\n</blockquote>\n<p>æ–°çš„ <strong>context API</strong> ä¸»è¦ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>\n<ul>\n<li><strong>React.createContext</strong>ï¼šç”¨äºä¼ é€’åˆå§‹å€¼ï¼Œè¿”å›ä¸€ä¸ªåŒ…å« <strong>provider</strong> å’Œ <strong>consumer</strong> çš„å¯¹è±¡ï¼›</li>\n<li><strong>provide</strong>ï¼šæ”¾ç½®åœ¨ç»„ä»¶æ ‘ä¸­çš„è¾ƒé«˜å±‚ï¼Œå¹¶å¯ä»¥æ¥æ”¶ä»»ä½•å€¼ï¼›</li>\n<li><strong>consume</strong>ï¼šåœ¨ <strong>provider</strong> ä¹‹åä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªè¿”å› <strong>JSX</strong> çš„å‡½æ•°ï¼ˆè¿™æœ‰ç‚¹åƒ <strong>render prop</strong> ç»„ä»¶ï¼Œä½† <strong>consume</strong> ä¸æ˜¯ç»„ä»¶ï¼‰ï¼›</li>\n</ul>\n<p>æˆ‘å¯¹è¿™ä¸ª <strong>API</strong> å……æ»¡äº†æœŸå¾…ï¼Œ<strong>React</strong> å›¢é˜Ÿä¹Ÿå°†ä¼šç§»é™¤ <strong>context æ˜¯å®éªŒæ€§ API</strong> çš„è­¦å‘Šï¼Œå› ä¸ºå®ƒç°åœ¨æ˜¯æ¡†æ¶ <a href=\"https://twitter.com/acdlite/status/957445801302618112\" target=\"_blank\" rel=\"noopener noreferrer\">ä¸€çº§æ£’çš„ç‰¹æ€§</a>ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¤§å®¶å°†ä¸å†é‚£ä¹ˆæ‹…å¿ƒä½¿ç”¨ <strong>context</strong> æ¥è§£å†³åº”ç”¨ä¸­ <strong>prop-drilling</strong> çš„é—®é¢˜äº†ï¼Œå¯¹ <strong>Redux</strong> ä¸å†é‚£ä¹ˆä¾èµ–ï¼Œå¯¹ <strong>React</strong> ä¹Ÿå°†æ›´åŠ å–œæ¬¢ã€‚</p>\n<p>è¿™æ˜¯æˆ‘æœ€è¿‘çš„æ¨æ–‡ï¼š</p>\n<div class=\"twitter-content\">\n\t<blockquote class=\"twitter-tweet\" data-lang=\"zh-cn\"><p lang=\"en\" dir=\"ltr\">People&#39;s fixation with keeping render methods small aggravates the &quot;prop drilling problem&quot; which makes folks want redux to help alleviate it</p>&mdash; Kent C. Dodds (@kentcdodds) <a href=\"https://twitter.com/kentcdodds/status/911276059051438082?ref_src=twsrc%5Etfw\">2017å¹´9æœˆ22æ—¥</a></blockquote>\n</div>\n<p>æˆ‘è®¤ä¸ºå¦‚æœæˆ‘ä»¬ä¸è¿‡æ—©æˆ–æ­¦æ–­åœ°å»ç ´å <strong>render</strong> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¸ä¼šé‚£ä¹ˆç—›è‹¦ï¼Œå³ä¾¿æœ€ç»ˆæˆ‘ä»¬å®åœ¨æ²¡æœ‰åŠæ³•é¿å…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ ¸å¿ƒçš„ <strong>React API</strong> æ¥è§£å†³ã€‚</p>\n<h2 id=\"context-å®è·µ\"><a href=\"#context-%E5%AE%9E%E8%B7%B5\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Context å®è·µ</h2>\n<p>æˆ‘çœ‹åˆ°äº†ä¸€ä¸ªå…³äº <strong>context API</strong>ï¼ˆæˆ–æ™®é€šçš„ <strong>render prop pattern</strong>ï¼‰çš„é—®é¢˜å¾ˆå¤šæ¬¡ï¼Œå°±æ˜¯å¦‚ä½•ç»„åˆ <strong>providers</strong> å’Œ <strong>consumers</strong>ï¼Œå½“åœ¨ä¸€ä¸ª <strong>render</strong> æ–¹æ³•ä¸­æŠŠä¸€å † <strong>render prop</strong> ç»„ä»¶æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œå°±ä¼šåƒè¿™æ · <a href=\"https://twitter.com/acdlite/status/955955121979969537\" target=\"_blank\" rel=\"noopener noreferrer\">åµŒå¥—</a>ã€‚</p>\n<div class=\"twitter-content\">\n\t<blockquote class=\"twitter-tweet\" data-conversation=\"none\" data-lang=\"zh-cn\"><p lang=\"en\" dir=\"ltr\">I mean come on (screen shot of actual code Iâ€™m playing with right now) <a href=\"https://t.co/Ucc8gaxPMp\">pic.twitter.com/Ucc8gaxPMp</a></p>&mdash; Andrew Clark (@acdlite) <a href=\"https://twitter.com/acdlite/status/955955121979969537?ref_src=twsrc%5Etfw\">2018å¹´1æœˆ24æ—¥</a></blockquote>\n</div>\n<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åšç‚¹ä»€ä¹ˆæ¥é¿å…å‘¢ï¼Ÿå…¶å®ï¼Œä¸ªäººè§‰å¾—æ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ï¼Œå¦‚æœä½ è§‰å¾—è¿™æ ·å¹¶ä¸å¥½ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¸¸è§„çš„ <strong>utility</strong> å‡½æ•°/ç»„ä»¶æ¥è§£å†³ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> ThemeContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'light'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">ThemeProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">/* code */</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ThemeConsumer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> ThemeContext<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> LanguageContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'en'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">LanguageProvider</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">/* code */</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">LanguageConsumer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> LanguageContext<span class=\"token punctuation\">.</span><span class=\"token function\">consume</span><span class=\"token punctuation\">(</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">AppProviders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token operator\">&lt;</span>LanguageProvider<span class=\"token operator\">></span>\n\t\t\t<span class=\"token operator\">&lt;</span>ThemeProvider<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeProvider<span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>LanguageProvider<span class=\"token operator\">></span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">ThemeAndLanguageConsumer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t\t<span class=\"token operator\">&lt;</span>LanguageConsumer<span class=\"token operator\">></span>\n\t\t\t<span class=\"token punctuation\">{</span>language <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n\t\t\t\t<span class=\"token operator\">&lt;</span>ThemeConsumer<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>theme <span class=\"token operator\">=></span> <span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> language<span class=\"token punctuation\">,</span> theme <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeConsumer<span class=\"token operator\">></span>\n\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n\t\t<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>LanguageConsumer<span class=\"token operator\">></span>\n\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token operator\">&lt;</span>AppProviders<span class=\"token operator\">></span>\n\t\t\t<span class=\"token operator\">&lt;</span>ThemeAndLanguageConsumer<span class=\"token operator\">></span>\n\t\t\t\t<span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> theme<span class=\"token punctuation\">,</span> language <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n\t\t\t\t\t<span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n\t\t\t\t\t\t<span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span> and <span class=\"token punctuation\">{</span>language<span class=\"token punctuation\">}</span>\n\t\t\t\t\t<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n\t\t\t\t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeAndLanguageConsumer<span class=\"token operator\">></span>\n\t\t<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>AppProviders<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>ç›®æ ‡æ˜¯ä½¿ç”¨å¸¸è§çš„æ¡ˆä¾‹ï¼Œç»“åˆç‰¹æ®ŠåŠŸèƒ½çš„å‡½æ•°/ç»„ä»¶ï¼Œä½¿æ¡ˆä¾‹æ›´åŠ å·¥ç¨‹åŒ–ã€‚</p>\n<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¤§å®¶è¿˜å¯ä»¥å‚è€ƒ <a href=\"https://medium.com/@jmeas\" target=\"_blank\" rel=\"noopener noreferrer\">jmeas</a> çš„ <a href=\"https://codesandbox.io/s/92pj14134y?from-embed\" target=\"_blank\" rel=\"noopener noreferrer\">react-composer</a>ã€‚</p>\n<p>åœ¨è¿™é‡Œéœ€è¦æåŠçš„æ˜¯ï¼Œåœ¨å®è·µä¸­ï¼Œå¹¶ä¸å»ºè®®å¤§å®¶åµŒå¥—æ¸²æŸ“ <strong>props components</strong>ï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œéƒ½å¯ä»¥é€‰æ‹©åˆ›å»ºå¤šä¸ªç®€å•æ˜“ç”¨çš„ç»„ä»¶ï¼Œç„¶åç»„åˆä½¿ç”¨ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æ€»ç»“</h2>\n<p>æ­£å¦‚ä¸Šé¢æ‰€è¯´çš„ï¼Œæˆ‘å¯¹è¿™ä¸ª <strong>API</strong> å……æ»¡äº†æœŸå¾…ã€‚ç›®å‰æš‚æœªå‘å¸ƒï¼Œä½†åº”è¯¥ä¼šåŒ…å«åœ¨ä¸‹ä¸€ä¸ª <strong>minor</strong> ç‰ˆæœ¬ä¸­ã€‚ä¸åŒæ‹…å¿ƒï¼Œä¹‹å‰çš„ <strong>API</strong> ä¼šç»§ç»­æ­£å¸¸å·¥ä½œï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª <strong>major</strong> ç‰ˆæœ¬å‘å¸ƒï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªäººéƒ½æœ‰æ—¶é—´è¿ç§»ï¼Œè€Œä¸”ä¸ç”¨è¿‡äºæ‹…å¿ƒï¼Œ<strong>React</strong> å›¢é˜Ÿåœ¨ <strong>Facebook</strong> æœ‰è¶…è¿‡ <strong>50,000</strong> ä¸ª <strong>React components</strong> éœ€è¦ç»´æŠ¤ï¼Œæ‰€ä»¥ï¼Œå°†æ¥å¾ˆæœ‰å¯èƒ½ä¼šå‘å¸ƒä¸€ä¸ª <strong>codemod</strong> å»è‡ªåŠ¨æ›´æ–°å¤§å¤šæ•°äººçš„ä»£ç ï¼ˆå°±åƒä»¥å¾€ä¸€æ ·ï¼‰ã€‚</p>\n<p>æœ€åå†è¡¨è¾¾ä¸€ä¸‹æˆ‘å¯¹æ­¤çš„å…´å¥‹ã€‚</p>\n<div class=\"twitter-content\">\n\t<blockquote class=\"twitter-tweet\" data-conversation=\"none\" data-lang=\"zh-cn\"><p lang=\"en\" dir=\"ltr\">That&#39;s one thing that excites me about the API improvement (in addition to other changes coming). So many new patterns will emerge out of this stuff. Ways of doing things we haven&#39;t considered before!!</p>&mdash; Kent C. Dodds (@kentcdodds) <a href=\"https://twitter.com/kentcdodds/status/956675313966239745?ref_src=twsrc%5Etfw\">2018å¹´1æœˆ25æ—¥</a></blockquote>\n</div>","fields":{"slug":"/2018-02-01-react-xin-de-context-api/"},"internal":{"content":"\n<div class=\"original-info\">\n  <div className=\"original-address\">\n    åŸæ–‡åœ°å€ï¼š\n    <a\n      href=\"https://blog.kentcdodds.com/reacts-%EF%B8%8F-new-context-api-70c9fe01596b\"\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n    >\n      React's âš›ï¸ new Context API\n    </a>\n  </div>\n  <div className=\"original-auth\">ä½œè€…ï¼škentcdodds</div>\n</div>\n\nè¿™ä¸å†æ˜¯ä¸€ä¸ª **å®éªŒæ€§çš„ API**ï¼Œå¹¶ä¸”å®ƒæ›´ç¬¦åˆå·¥ç¨‹åŒ–çš„ç†å¿µï¼Œç›®å‰å®ƒå·²æˆä¸º **React ä¸€çº§æ£’çš„ API**ã€‚\n\n> âš ï¸ ï¼šå¤§å®¶å¯ä»¥é€šè¿‡ [newsletter](https://tinyletter.com/kentcdodds) è·å–æˆ‘æœ€æ–°çš„èµ„è®¯ï¼Œæˆ‘ä¸€èˆ¬æ¯ä¸¤å‘¨é€šè¿‡é‚®ä»¶å‘é€ä¸€æ¬¡ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡è‡ªå·±çš„æ”¶ä»¶ç®±è·å–æ›´å¤šçš„å†…å®¹ã€‚\n\n**React** ä¸­çš„ **context API** ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“å§ï¼Œå¯èƒ½è·Ÿå¤§ä¼™ä¸€æ ·ï¼Œå½“çœ‹åˆ° **React** çš„å®˜æ–¹æ–‡æ¡£æ˜¯è¿™æ ·æ—¶ï¼Œéƒ½ä¸æ•¢ç›´æ¥ä½¿ç”¨å®ƒã€‚\n\n![API](./images/API.png)\n\nç¬¬ä¸€æ¡æœç´¢ç»“æœæ˜¾ç¤ºçš„å°±æ˜¯ [ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨ context](https://reactjs.org/docs/context.html#why-not-to-use-context)ï¼Œè®©å¤§å®¶ç¬é—´äº§ç”Ÿå¿§è™‘ï¼Œè¯¥ç« èŠ‚æ˜¯è¿™ä¹ˆæè¿° **context** çš„ï¼š\n\n> å¦‚æœä½ æƒ³è®©ä½ çš„åº”ç”¨æ›´åŠ ç¨³å®šï¼Œå°±åˆ«ä½¿ç”¨ **context**ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª **å®éªŒæ€§çš„ API**ï¼Œåœ¨æœªæ¥çš„ **React** ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šå‘ç”Ÿæ”¹å˜ã€‚\n\nâš ï¸ æ³¨æ„ï¼Œè¿™é‡Œçš„æ”¹å˜åŒ…å«ä¸­æ–­ï¼Œç»ˆæ­¢ï¼Œä¸å†ä½¿ç”¨ã€‚\n\n## é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ context å‘¢\n\nä½ æ›¾ç»å†è¿‡å°è¯•åœ¨ä¸€ä¸ªå±‚çº§å¾ˆæ·±çš„ç»„ä»¶ä¸­è·å–æœ€å¤–å±‚ç»„ä»¶çš„ **state** çš„ç—›è‹¦ä¹ˆï¼Œè¿™ç§ç—›è‹¦å« **prop drilling**ï¼Œå¯è°“è®©äººæ¥è¿‘å´©æºƒçš„ã€‚å½“é‡åˆ°è¿™ç§æƒ…å½¢æ—¶ï¼Œä½ è‚¯å®šä¸ä¼šå–œæ¬¢ç”¨ **props** æ¥ä¼ é€’æ•°æ®ï¼Œå› ä¸ºå¦‚æœä¸­é—´æœ‰ä¸ªç»„ä»¶å‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªä»£ä»·å°†æ˜¯å‡ ä½• ğŸ˜‚ã€‚\n\nå®é™…ä¸Šï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å¸¸è§„çš„ **JavaScript module** æ¥è§„é¿ä»¥ä¸Šçš„é—®é¢˜ï¼Œå°†æ•°æ®å­˜åœ¨æŸä¸ª **module** ä¸­ï¼Œå°±å¯ä»¥å®ç°åœ¨ä»»ä½•åœ°æ–¹è®¿é—®å’Œå¯¼å…¥äº†ï¼Œä½†è¿™ä¹ˆåšä¼šè®©æ›´æ–°å˜å¾—å›°éš¾ï¼ˆä½ å¿…é¡»å®ç°ä¸€ä¸ª **event** åœ¨æ•°æ®æ›´æ–°æ—¶è§¦å‘ï¼Œé€šçŸ¥ç”¨æˆ·æ•°æ®å‘ç”Ÿæ”¹å˜ï¼‰ï¼Œå¹¶ä¸”ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“å¯¹ **module** ä¹Ÿä¼šæœ‰ [å½±å“](https://stackoverflow.com/questions/40935571/why-singleton-store-in-flux-can-cause-issue-for-server-side-rendering/40974748#40974748)ã€‚\n\nå› æ­¤ï¼Œåƒ [redux](https://redux.js.org/) è¿™æ ·çš„è´Ÿè´£ **çŠ¶æ€ç®¡ç†** çš„ç¬¬ä¸‰æ–¹åº“è¿›å…¥äº†å¤§å®¶çš„è§†é‡ã€‚å®ƒå…è®¸ä½ åœ¨ä»»ä½•åœ°æ–¹ä» **store** è·å–æ•°æ®ï¼Œä½ éœ€è¦åšçš„åªæ˜¯ä½¿ç”¨ **Provider** åŒ…è£…ä¸€ä¸‹ï¼Œç„¶åå°±å¯ä»¥ç¥å¥‡åœ°åœ¨ **connected** çš„ç»„ä»¶ä¸­è½»æ¾åœ°è·å–æƒ³è¦çš„æ•°æ®äº†ã€‚\n\nç„¶è€Œï¼Œå¦‚æœæˆ‘å‘Šè¯‰ä½  **Provider** å°±æ˜¯åœ¨ä½¿ç”¨ **context** è¿™ä¸ª **å®éªŒæ€§ API** å‘¢ï¼ŸğŸ˜± äº‹å®ç¡®å®æ˜¯è¿™æ ·çš„ï¼**provider** ç»„ä»¶å°†æ•°æ®å­˜è¿› **context** ä¸­ï¼Œ**connect** é«˜é˜¶ç»„ä»¶ä» **context** è·å–æ•°æ®ï¼Œæ‰€ä»¥ï¼Œ**redux** äº‹å®å¹¶ä¸å…è®¸ä½ çš„æ•°æ®åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ã€‚\n\né‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨ **context** å‘¢ï¼Ÿå¯èƒ½æ˜¯å¤§å®¶å·²ç»æ·±æ·±åœ°çˆ±ä¸Šå®ƒäº†å§ï¼å³ä½¿ä½ æ²¡æœ‰ç›´æ¥ä½¿ç”¨ **context**ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¹Ÿä¼šé€šè¿‡å¼•ç”¨åƒ [react-redux](https://github.com/reactjs/react-redux/blob/76dd7faa90981dd2f9efa76f3e2f26ecf2c12cf7/src/components/connectAdvanced.js#L136-L143)ï¼Œ [MobX-react](https://github.com/mobxjs/mobx-react/blob/dc249910c74c1b2e988a879be07f10aeaea90936/src/Provider.js#L19-L34)ï¼Œ [react-router](https://github.com/ReactTraining/react-router/blob/e6f9017c947b3ae49affa24cc320d0a86f765b55/packages/react-router/modules/Router.js#L23-L34)ï¼Œ [glamorous](https://github.com/paypal/glamorous/blob/7468bfc76f46783cac841e20973ed119c771f3b7/src/theme-provider.js#L33-L37) è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“é—´æ¥ç”¨åˆ°å®ƒã€‚\n\n## Context é‡ç”Ÿå•¦\n\nç°åœ¨æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬æ˜¯å¦‚æ­¤åœ°çƒ­çˆ± **context**ï¼Œä½†å®˜æ–¹æ–‡æ¡£çš„è­¦å‘Šä¾ç„¶è¿˜åœ¨ï¼šåœ¨ **React** çš„æœªæ¥ç‰ˆæœ¬ä¸­ï¼Œå¯èƒ½ä¸å†ä½¿ç”¨å®ƒï¼Œå¥½æ¶ˆæ¯æ˜¯ï¼Œ**context** è¦æ­£å¼è·Ÿå¤§å®¶æ‰“æ‹›å‘¼äº†ï¼Œè€Œä¸”å¤§å®¶å¯èƒ½ä¼šæ¯”ä¹‹å‰æ›´çˆ±å®ƒã€‚\n\nä¸€ä¸ªæœˆå‰ï¼Œ**React** å›¢é˜Ÿ ä» [yarn](https://github.com/yarnpkg/rfcs)ï¼Œ[rust](https://github.com/rust-lang/rfcs) å’Œ [Ember](https://github.com/emberjs/rfcs) çš„ **rfcs ä»“åº“** å—åˆ°å¯å‘ï¼Œå»ºç«‹äº†ä¸€ä¸ªè‡ªå·±çš„ [rfcs](https://github.com/reactjs/rfcs) ä»“åº“ã€‚ä»“åº“ç¬¬ä¸€ä¸ª **PR** æ¥è‡ª [Andrew Clark](https://twitter.com/acdlite)ï¼ˆReact å›¢é˜Ÿæ ¸å¿ƒæˆå‘˜ï¼‰ï¼Œ**PR** æ ‡é¢˜ä¸º [New version of context](https://github.com/reactjs/rfcs/pull/2)ï¼Œå…¶ä¸­ **Andrew Clark** æ¦‚è¿°äº†æœªæ¥æ–°ç‰ˆæœ¬çš„ **context** æ˜¯æ€æ ·çš„ï¼Œä¹‹åè¿˜å­˜åœ¨ä¸€äº›æœ‰è¶£çš„è®¨è®ºï¼Œå‡ å¤©åï¼Œ**Andrew Clark** å°±å‘ **React** ä»“åº“æäº†ä¸€ä¸ª [New context API](https://github.com/facebook/react/pull/11818) çš„ **PR**ã€‚\n\né‚£ä¹ˆï¼Œåˆ°åº•æœ‰ä»€ä¹ˆæ”¹å˜å‘¢ï¼Ÿæ®è‚‰çœ¼ä¼°è®¡ï¼Œæ–°çš„ **API** ä¸ä¹‹å‰çš„ **API** å­˜åœ¨ç™¾ä¸‡çº§åˆ«çš„å·®å¼‚ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ [ç¤ºä¾‹](https://codesandbox.io/s/n4r0qq898j?from-embed)ï¼š\n\n```javascript\nconst ThemeContext = React.createContext('light');\nclass ThemeProvider extends React.Component {\n\tstate = { theme: 'light' };\n\trender() {\n\t\treturn ThemeContext.provide(this.state.theme, this.props.children);\n\t}\n}\n\nconst ThemeConsumer = ({ children }) => ThemeContext.consume(children);\n\nclass App extends React.Component {\n\trender() {\n\t\t<ThemeProvider>\n\t\t\t<ThemeConsumer>{val => <div>{val}</div>}</ThemeConsumer>\n\t\t</ThemeProvider>;\n\t}\n}\n```\n\n> ä½ å¯èƒ½æ³¨æ„åˆ°ç¤ºä¾‹ä¸­ä½¿ç”¨åˆ°ä¸€ä¸ª **render prop**ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•å…³äºéœ€è¦ä½¿ç”¨ **render prop** çš„ **context API**ï¼Œä½ å¯ä»¥ä½¿ç”¨ **context API** è½»æ¾å®ç°é«˜é˜¶ç»„ä»¶æˆ–å…¶ä»–åŠŸèƒ½ã€‚\n\næ–°çš„ **context API** ä¸»è¦ç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š\n\n- **React.createContext**ï¼šç”¨äºä¼ é€’åˆå§‹å€¼ï¼Œè¿”å›ä¸€ä¸ªåŒ…å« **provider** å’Œ **consumer** çš„å¯¹è±¡ï¼›\n- **provide**ï¼šæ”¾ç½®åœ¨ç»„ä»¶æ ‘ä¸­çš„è¾ƒé«˜å±‚ï¼Œå¹¶å¯ä»¥æ¥æ”¶ä»»ä½•å€¼ï¼›\n- **consume**ï¼šåœ¨ **provider** ä¹‹åä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªè¿”å› **JSX** çš„å‡½æ•°ï¼ˆè¿™æœ‰ç‚¹åƒ **render prop** ç»„ä»¶ï¼Œä½† **consume** ä¸æ˜¯ç»„ä»¶ï¼‰ï¼›\n\næˆ‘å¯¹è¿™ä¸ª **API** å……æ»¡äº†æœŸå¾…ï¼Œ**React** å›¢é˜Ÿä¹Ÿå°†ä¼šç§»é™¤ **context æ˜¯å®éªŒæ€§ API** çš„è­¦å‘Šï¼Œå› ä¸ºå®ƒç°åœ¨æ˜¯æ¡†æ¶ [ä¸€çº§æ£’çš„ç‰¹æ€§](https://twitter.com/acdlite/status/957445801302618112)ï¼Œè¿™ä¹Ÿæ„å‘³ç€å¤§å®¶å°†ä¸å†é‚£ä¹ˆæ‹…å¿ƒä½¿ç”¨ **context** æ¥è§£å†³åº”ç”¨ä¸­ **prop-drilling** çš„é—®é¢˜äº†ï¼Œå¯¹ **Redux** ä¸å†é‚£ä¹ˆä¾èµ–ï¼Œå¯¹ **React** ä¹Ÿå°†æ›´åŠ å–œæ¬¢ã€‚\n\nè¿™æ˜¯æˆ‘æœ€è¿‘çš„æ¨æ–‡ï¼š\n\n<div class=\"twitter-content\">\n\t<blockquote class=\"twitter-tweet\" data-lang=\"zh-cn\"><p lang=\"en\" dir=\"ltr\">People&#39;s fixation with keeping render methods small aggravates the &quot;prop drilling problem&quot; which makes folks want redux to help alleviate it</p>&mdash; Kent C. Dodds (@kentcdodds) <a href=\"https://twitter.com/kentcdodds/status/911276059051438082?ref_src=twsrc%5Etfw\">2017å¹´9æœˆ22æ—¥</a></blockquote>\n</div>\n\næˆ‘è®¤ä¸ºå¦‚æœæˆ‘ä»¬ä¸è¿‡æ—©æˆ–æ­¦æ–­åœ°å»ç ´å **render** æ–¹æ³•ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¸ä¼šé‚£ä¹ˆç—›è‹¦ï¼Œå³ä¾¿æœ€ç»ˆæˆ‘ä»¬å®åœ¨æ²¡æœ‰åŠæ³•é¿å…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ ¸å¿ƒçš„ **React API** æ¥è§£å†³ã€‚\n\n## Context å®è·µ\n\næˆ‘çœ‹åˆ°äº†ä¸€ä¸ªå…³äº **context API**ï¼ˆæˆ–æ™®é€šçš„ **render prop pattern**ï¼‰çš„é—®é¢˜å¾ˆå¤šæ¬¡ï¼Œå°±æ˜¯å¦‚ä½•ç»„åˆ **providers** å’Œ **consumers**ï¼Œå½“åœ¨ä¸€ä¸ª **render** æ–¹æ³•ä¸­æŠŠä¸€å † **render prop** ç»„ä»¶æ”¾åœ¨ä¸€èµ·æ—¶ï¼Œå°±ä¼šåƒè¿™æ · [åµŒå¥—](https://twitter.com/acdlite/status/955955121979969537)ã€‚\n\n<div class=\"twitter-content\">\n\t<blockquote class=\"twitter-tweet\" data-conversation=\"none\" data-lang=\"zh-cn\"><p lang=\"en\" dir=\"ltr\">I mean come on (screen shot of actual code Iâ€™m playing with right now) <a href=\"https://t.co/Ucc8gaxPMp\">pic.twitter.com/Ucc8gaxPMp</a></p>&mdash; Andrew Clark (@acdlite) <a href=\"https://twitter.com/acdlite/status/955955121979969537?ref_src=twsrc%5Etfw\">2018å¹´1æœˆ24æ—¥</a></blockquote>\n</div>\n\né‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥åšç‚¹ä»€ä¹ˆæ¥é¿å…å‘¢ï¼Ÿå…¶å®ï¼Œä¸ªäººè§‰å¾—æ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ï¼Œå¦‚æœä½ è§‰å¾—è¿™æ ·å¹¶ä¸å¥½ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¸¸è§„çš„ **utility** å‡½æ•°/ç»„ä»¶æ¥è§£å†³ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š\n\n```javascript\nconst ThemeContext = React.createContext('light');\nclass ThemeProvider extends React.Component {\n\t/* code */\n}\nconst ThemeConsumer = ({ children }) => ThemeContext.consume(children);\nconst LanguageContext = React.createContext('en');\nclass LanguageProvider extends React.Component {\n\t/* code */\n}\nconst LanguageConsumer = ({ children }) => LanguageContext.consume(children);\n\nfunction AppProviders({ children }) {\n\treturn (\n\t\t<LanguageProvider>\n\t\t\t<ThemeProvider>{children}</ThemeProvider>\n\t\t</LanguageProvider>\n\t);\n}\n\nfunction ThemeAndLanguageConsumer({ children }) {\n\treturn (\n\t\t<LanguageConsumer>\n\t\t\t{language => (\n\t\t\t\t<ThemeConsumer>{theme => children({ language, theme })}</ThemeConsumer>\n\t\t\t)}\n\t\t</LanguageConsumer>\n\t);\n}\n\nclass App extends React.Component {\n\trender() {\n\t\t<AppProviders>\n\t\t\t<ThemeAndLanguageConsumer>\n\t\t\t\t{({ theme, language }) => (\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{theme} and {language}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</ThemeAndLanguageConsumer>\n\t\t</AppProviders>;\n\t}\n}\n```\n\nç›®æ ‡æ˜¯ä½¿ç”¨å¸¸è§çš„æ¡ˆä¾‹ï¼Œç»“åˆç‰¹æ®ŠåŠŸèƒ½çš„å‡½æ•°/ç»„ä»¶ï¼Œä½¿æ¡ˆä¾‹æ›´åŠ å·¥ç¨‹åŒ–ã€‚\n\né™¤æ­¤ä¹‹å¤–ï¼Œå¤§å®¶è¿˜å¯ä»¥å‚è€ƒ [jmeas](https://medium.com/@jmeas) çš„ [react-composer](https://codesandbox.io/s/92pj14134y?from-embed)ã€‚\n\nåœ¨è¿™é‡Œéœ€è¦æåŠçš„æ˜¯ï¼Œåœ¨å®è·µä¸­ï¼Œå¹¶ä¸å»ºè®®å¤§å®¶åµŒå¥—æ¸²æŸ“ **props components**ï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™ï¼Œéƒ½å¯ä»¥é€‰æ‹©åˆ›å»ºå¤šä¸ªç®€å•æ˜“ç”¨çš„ç»„ä»¶ï¼Œç„¶åç»„åˆä½¿ç”¨ã€‚\n\n## æ€»ç»“\n\næ­£å¦‚ä¸Šé¢æ‰€è¯´çš„ï¼Œæˆ‘å¯¹è¿™ä¸ª **API** å……æ»¡äº†æœŸå¾…ã€‚ç›®å‰æš‚æœªå‘å¸ƒï¼Œä½†åº”è¯¥ä¼šåŒ…å«åœ¨ä¸‹ä¸€ä¸ª **minor** ç‰ˆæœ¬ä¸­ã€‚ä¸åŒæ‹…å¿ƒï¼Œä¹‹å‰çš„ **API** ä¼šç»§ç»­æ­£å¸¸å·¥ä½œï¼Œç›´åˆ°ä¸‹ä¸€ä¸ª **major** ç‰ˆæœ¬å‘å¸ƒï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ªäººéƒ½æœ‰æ—¶é—´è¿ç§»ï¼Œè€Œä¸”ä¸ç”¨è¿‡äºæ‹…å¿ƒï¼Œ**React** å›¢é˜Ÿåœ¨ **Facebook** æœ‰è¶…è¿‡ **50,000** ä¸ª **React components** éœ€è¦ç»´æŠ¤ï¼Œæ‰€ä»¥ï¼Œå°†æ¥å¾ˆæœ‰å¯èƒ½ä¼šå‘å¸ƒä¸€ä¸ª **codemod** å»è‡ªåŠ¨æ›´æ–°å¤§å¤šæ•°äººçš„ä»£ç ï¼ˆå°±åƒä»¥å¾€ä¸€æ ·ï¼‰ã€‚\n\næœ€åå†è¡¨è¾¾ä¸€ä¸‹æˆ‘å¯¹æ­¤çš„å…´å¥‹ã€‚\n\n<div class=\"twitter-content\">\n\t<blockquote class=\"twitter-tweet\" data-conversation=\"none\" data-lang=\"zh-cn\"><p lang=\"en\" dir=\"ltr\">That&#39;s one thing that excites me about the API improvement (in addition to other changes coming). So many new patterns will emerge out of this stuff. Ways of doing things we haven&#39;t considered before!!</p>&mdash; Kent C. Dodds (@kentcdodds) <a href=\"https://twitter.com/kentcdodds/status/956675313966239745?ref_src=twsrc%5Etfw\">2018å¹´1æœˆ25æ—¥</a></blockquote>\n</div>\n"},"frontmatter":{"title":"React âš›ï¸ æ–°çš„ Context API","tag":"FrontEnd,React,context","date":"2018-02-01","original":false}}},"pageContext":{"slug":"/2018-02-01-react-xin-de-context-api/"}}